{{template "admin" .}}

{{define "page-title"}}
    Dashboard
{{end}}

{{define "content"}}
    <div class="col-md-12" >
        <table class="table table-striped table-hover" id="all-users">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Borrowed Books</th>
                    <th>Delete User</th>

                </tr>
            </thead>
            <tbody>
            <tr>
            </tr>
            </tbody>
        </table>
    </div>
{{end}}

{{define "js"}}
<script>

    fetch("/usersapi", {
        method: "get",
    })

        .then(response => response.json()).then(data => {
        if (data) {


            for (let i = 0; i < data.length; i++) {

            let newrow = [data[i]["id"].toString(), data[i]["first_name"],
                data[i]["last_name"], data[i]["borrowed_count"].toString()];
            dataTable.rows().add(newrow);
        }





        }


    }).then(function()
    {
        let deleteBtn = document.querySelectorAll("tr")
        for (let item of deleteBtn) {
            let td = item.querySelectorAll("td");
            if (td && td.length > 2) {
                let borrow = td[3];
                if (parseInt(td[3].innerText) > 0) {
                borrow.innerHTML = `<a href="userbooks/${td[0].innerText}">`+ td[3].innerText +'</a>';
                }
                td[4].innerHTML = `<button type="button" id="delete" style="font-size: 8px;" >X</button>`;
                td[4].addEventListener("click", function() {
                    var result = confirm("Want to delete?");
                    if (result) {
                        fetch("/delete", {
                            method: "post",
                            body: JSON.stringify({id: parseInt(td[0].innerText)})
                        }).then(function() {location.reload();})
                    }

                })
            }

        }




    })



</script>

{{end}}