{{template "admin" .}}

{{define "page-title"}}
    Dashboard
{{end}}

{{define "content"}}
    <div class="col-md-12" >
        <table class="table table-striped table-hover" id="all-users">
            <thead>
                <tr>
                    <th>Book ID</th>
                    <th>Book Title</th>
                    <th>User ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Return Book</th>
                </tr>
            </thead>
            <tbody>
            <tr>
            </tr>
            </tbody>
        </table>
    </div>
{{end}}

{{define "js"}}
<script>



    fetch("/all-borrowed-booksapi", {
        method: "get",
    })

        .then(response => response.json()).then(data => {
        if (data) { // ok je spremenljivka v nasem jsonu, zato je truthy


            for (let i = 0; i < data.length; i++) {
            let newrow = [data[i]["bookid"].toString(),
                data[i]["book"],
                data[i]["id"].toString(),
                data[i]["first_name"],
                data[i]["last_name"]]
                dataTable.rows().add(newrow)
        }

        }
    }).then(function()
    {
        let Returnbtn = document.querySelectorAll("tr")
        for (let item of Returnbtn) {
            let td = item.querySelectorAll("td");
            if (td && td.length > 2) {
                // let borrow = td[3]
                // if (parseInt(td[3].innerText) > 0) {
                //     borrow.innerHTML = `<a href="user/${td[0].innerText}">`+ td[3].innerText +'</a>'
                // }
                td[5].innerHTML = `<button type="button" id="return" style="font-size: 8px;" >X</button>`
                td[5].addEventListener("click", function() {
                    let result = confirm(`Want to return ${td[1].innerText} for User ${td[3].innerText} ${td[4].innerText}?`);
                    if (result) {
                        fetch("/returnbook", {
                            method: "post",
                            body: JSON.stringify({user_id: parseInt(td[2].innerText), book_id: parseInt(td[0].innerText), })
                        }).then(function() {location.reload();})

                }})


            }}})





</script>

{{end}}