{{template "admin" .}}

{{define "page-title"}}
    Dashboard
{{end}}

{{define "content"}}
    <div class="col-md-12" >
        <table class="table table-striped table-hover" id="all-users">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Books Available</th>
                    <th>Borrow Book</th>
                </tr>
            </thead>
            <tbody>
            <tr>
            </tr>
            </tbody>
        </table>
    </div>
{{end}}

{{define "js"}}
<script>



    fetch("/booksapi", {
        method: "get",
    })

        .then(response => response.json()).then(data => {
        if (data) {
            for (let i = 0; i < data.length; i++) {
            let newrow = [data[i]["id"].toString(), data[i]["title"], data[i]["availability"].toString()];
            dataTable.rows().add(newrow)
        }

        }
    }).then(function()
        {
            let borrowBtn = document.querySelectorAll("tr");
            for (let item of borrowBtn) {
                let td = item.querySelectorAll("td");
                if (td && td.length > 2) {
                    if (parseInt(td[2].innerText) > 0) {
                    td[3].innerHTML = `<button type="button" id="borrow" style="font-size: 8px;" >X</button>`;

                    td[3].addEventListener("click", function() {
                        let result = prompt("Enter User ID");
                        if (result) {
                            fetch("/borrowbook", {
                                method: "post",
                                body: JSON.stringify({book_id: parseInt(td[0].innerText), user_id: parseInt(result) })
                            }).then(response => response.text())
                              .then(response => {
                                  if (response) {
                                      alert(response);
                                  } else {
                                      alert(`Borrowed ${td[1].innerText} for User ${result}`);
                                  }





                        })


                }

            })
                    }


                }}})



</script>

{{end}}